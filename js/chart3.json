{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "description": "Diverging Stacked Bar Chart with small multiples for gender comparisons.",
    "data": {
      "url": "data/global-education.csv",
      "format": {"type": "csv"}
    },
    "transform": [
      {"fold": ["Completion_Rate_Primary_Male", "Completion_Rate_Primary_Female", 
                "Completion_Rate_Lower_Secondary_Male", "Completion_Rate_Lower_Secondary_Female"],
       "as": ["key", "value"]},
      {"calculate": "indexof(datum.key, 'Male') > -1 ? 'Male' : 'Female'", "as": "gender"},
      {"calculate": "replace(datum.key, /_(Male|Female)/, '')", "as": "education_level"}
    ],
    "facet": {"field": "Countries and areas", "columns": 4},  
    "spec": {
      "mark": "bar",
      "encoding": {
        "x": {
          "field": "education_level", "type": "nominal", "title": "Education Level",
          "axis": {"labelAngle": 0}
        },
        "y": {
          "field": "value", "type": "quantitative", "title": "Completion Rate (%)",
          "stack": "zero"
        },
        "color": {
          "field": "gender", "type": "nominal", "scale": {"range": ["#675193", "#ca8861"]},
          "legend": {"title": "Gender"}
        }
      }
    }
  }
  